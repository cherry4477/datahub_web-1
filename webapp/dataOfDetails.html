<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>dataHub-数据拥有方详情</title>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/command.css">
	<link rel="stylesheet" href="css/loader.css">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="css/search.css">
</head>

<style>
	.nav > li > a:hover{
		background-color:rgba(31,154,218,0.7);
	}
	.navbar-toggle .icon-bar {
		background-color: #fff;
	}
	.navbar-nav > li > a:focus{
		background:none;
	}
	@media (max-width:768px) {
				#terminal-content-body{				
					display:none;	
				}
				body{
					background-color:#f6f9fc  !important;
				}
				#userDet{
				margin:90px 40px 0px 40px;
				margin-top:90px !important;
				padding:0px 0px !important;
				
					
				}
				#userName{
					background:#c0c0c0;
					color:white ;
					font-size:26px !important;
					padding:15px 0px 15px 36px;
					margin:0 0 !important;
				}
				#userCom{
					color:#666666;
					font-size:20px;
					line-height:30px;
					min-height:120px;
					padding:36px 36px 36px 36px;
					margin:0 0 !important;
					
				}
	}
</style>

<body  style="background-color: #f5f5f5;">
	<div class="be-loader" style="display: block;">
		<div class="spinner">
			<div class="spinner-container container1">
				<div class="circle1"></div>
				<div class="circle2"></div>
				<div class="circle3"></div>
				<div class="circle4"></div>
			</div>
			<div class="spinner-container container2">
				<div class="circle1"></div>
				<div class="circle2"></div>
				<div class="circle3"></div>
				<div class="circle4"></div>
			</div>
			<div class="spinner-container container3">
				<div class="circle1"></div>
				<div class="circle2"></div>
				<div class="circle3"></div>
				<div class="circle4"></div>
			</div>
		</div>
	</div>
	<header></header>
	<div id="userDet" class="container" style="margin-top:50px;background-color: #fff;padding: 0px 40px;">
		<div id="userName" style="float: left;margin-top:22px;margin-bottom: 10px;font-weight: bold;width:100%;font-size:20px;"></div>
		<div id="userCom" style="float: left;margin-bottom:15px;"></div>
	</div>
	<div class="container" style="padding: 0px;">
		<div class="col-md-12 col-sm-12" id="lComs" style="padding: 0px;">			
			<div id="terminal-content-head"></div>
			<div id="terminal-content-body"></div>	
		</div>
	</div>
	<footer></footer>
	<div id="loginTem"></div>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="js/ngUrl.js"></script>
<script src="js/login.js"></script>
<script src="js/base64.js"></script>
<script src="js/md5.js"></script>
<script>
	$("a").focus(function(){this.blur()});
	$("header").load("common/header.html");
	$("footer").load("common/footer.html");
	$("#loginTem").load("common/login.html");
	$(window).load(function(){
		$(".be-loader").fadeOut("slow");
	});
	var repos=[];
	$(document).ready(function(){
		ajaxRe();
		
		$.ajax({
			url: ngUrl+"/repositories?username="+getParam("username"),
    		type: "get",
    		cache:false,
    	   	async:false,
    		dataType:'json',
    		success:function(json){  
    			if(json.data.length!=0){
    				var pages=json.data.length;
    				for(var i=0;i<pages;i++){
    					repos.push([json.data[i].repname]);			
    				}
    			}else{
    				console.log("报错");
    			}		
    		},
    		error:function(json){
    			alert("程序出错，请稍后重试");
    		}
    	});
		

		
		for(var i=0;i<repos.length;i++){
			$.ajax({
				url: ngUrl+"/repositories/"+repos[i],
	    		type: "get",
	    		cache:false,
	    	   	async:false,
	    		dataType:'json',
	    		success:function(json){ 
	    			$("#loading").empty();
	    				
	    				/* var times=json.data.optime;
	    				var jdTime="";
	    				var xdTime="";
	    				var showTime="";
	    				var nums=times.indexOf("|");
	    				if(nums!="-1"){
	    					jdTime=times.substring(0,nums+1);
	    					xdTime=times.substring(nums+1,times.length);
	    					showTime=xdTime;
	    				}else{
	    					showTime=times;
	    				} */
	    				
	    			var times=json.data.optime;
    				var jdTime=times.substring(0, times.indexOf("."));
    				var xdTime="";
    				var showTime="";
    				var nums=times.indexOf("|");
    				if(nums!="-1"){
    					showTime=times.substring(times.indexOf("|")+1,times.length);
    				}else{
    					showTime=times.substring(0, times.indexOf("."));
    				} 
	    				
	    				var subnum="";
	    				$.ajax({
	    					url: ngUrl+"/subscription_stat/"+repos[i],
	    					type: "get",
	    					cache:false,
	    					data:{},
	    					async:false,
	    					dataType:'json',
	    					success:function(json){
	    						if(json.code == 0){
	    							subnum=json.data.numsubs;
	    						}else {
	    							console.log("报错");
	    						}
	    					},
	    					error:function(json){
	    						alert("程序出错，请稍后重试");
	    					}
	    				});
	    				
	    				var transnum="";
	    				$.ajax({
	    					url: ngUrl+"/transaction_stat/"+repos[i],
	    					type: "get",
	    					cache:false,
	    					data:{},
	    					async:false,
	    					dataType:'json',
	    					success:function(json){
	    						if(json.code == 0){
	    							transnum=json.data.numpulls;
	    						}else {
	    							console.log("报错");
	    						}
	    					},
	    					error:function(json){
	    						alert("程序出错，请稍后重试");
	    					}
	    				});
	    				
	    				var starsnum="";
	    				$.ajax({
	    					url: ngUrl+"/star_stat/"+repos[i],
	    					type: "get",
	    					cache:false,
	    					data:{},
	    					async:false,
	    					dataType:'json',
	    					success:function(json){
	    						if(json.code == 0){
	    							starsnum=json.data.numstars;
	    						}else {
	    							console.log("报错");
	    						}
	    					},
	    					error:function(json){
	    						alert("程序出错，请稍后重试");
	    					}
	    				});
	    						    				
	    				
    					$("#terminal-content-body").append(""+
		    					"<div class='selectBody' style='background:#fff;float:left;margin-bottom:30px;'>"+
									"<div class='repo-head'>"+
										"<div class='tab-head-div'><a style='color:#0077aa' href='repDetails.html?repname="+repos[i]+"'>"+repos[i]+"</a></div>"+
									//	"<div class='tab-head-icon'></div>"+
									"</div>"+
									"<div class='repo-body'>"+
										"<div id='repo-text'>"+json.data.comment+"</div>"+
										"<div class='repo-body-tail'>"+
											"<div class='repo-body-tail-left'>"+
												"<div class='updatetime-icon' title='更新时间'></div>"+
												"<div class='updatetime-value' title='"+jdTime+"'>"+showTime+"</div>"+
												"<div class='tag-iconItem' title='item数量'></div>"+
												"<div class='tag-value'>"+json.data.items+"</div>"+
											"</div>"+
											"<div class='repo-body-tail-mid'>&nbsp;&nbsp;&nbsp;"+
		    								"</div>"+
											"<div class='repo-body-tail-right'>"+
												"<div class='shwr'>"+
													"<div class='star-icon' title='star量'></div>"+
													"<div class='star-value'>"+starsnum+"</div>"+
													"<div class='subscript-icon' title='订阅量'></div>"+
					                                "<div class='subscript-value'>"+subnum+"</div>"+
					                                "<div class='downloaded-icon' title='pull量'></div>"+
					                                "<div class='downloaded-value'>"+transnum+"</div>"+
		    				                    "</div>"+
											"</div>"+
										"</div>"+
									"</div>"+
								"</div>"
		    				);	    		
	    		},
	    		error:function(json){
	    			alert("程序出错，请稍后重试");
	    		}
    		}); 
		}
		
	});


	function ajaxRe(){
		var username = getParam("username");
		$.ajax({
			url: ngUrl+"/users/"+username,
			type: "get",
			cache:false,
			data:{},
			async:false,
			dataType:'json',
			success:function(json){
				if(json.code == 0){
					$("#userName").text(json.data.userName);
					$("#userCom").text(json.data.comment);
				}else {
					console.log("报错");
				}
			},
			error:function(json){
				alert("程序出错，请稍后重试");
			}
		});
	}
	function getParam(key) {
		var value='';
		var itemid = new RegExp("\\?.*"+key+"=([^&]*).*$");
		if (itemid.test(decodeURIComponent(window.location.href))) {
			value = itemid.exec(decodeURIComponent(window.location.href))[1];
		}
		return value;
	}
</script>
</html>